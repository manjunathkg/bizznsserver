// Metawidget 3.2 (licensed under LGPL)
//
// This library is free software; you can redistribute it and/or
// modify it under the terms of the GNU Lesser General Public
// License as published by the Free Software Foundation; either
// version 2.1 of the License, or (at your option) any later version.
//
// This library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
// Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public
// License along with this library; if not, write to the Free Software
// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA

"use strict";
metawidget.jqueryui=metawidget.jqueryui||{};
metawidget.jqueryui.widgetbuilder=metawidget.jqueryui.widgetbuilder||{};
metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder=function(){if(!(this instanceof metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder)){throw new Error("Constructor called as a function")
}};
metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder.prototype.buildWidget=function(a,e){if(a.readOnly==="true"){return
}if(a.hidden==="true"){return
}if(a.type==="number"){if(a.minimumValue&&a.maximumValue){var c=document.createElement("div");
$(c).slider();
return c
}var d=document.createElement("input");
$(d).spinner();
return $(d).spinner("widget")[0]
}if(a.type==="date"){var b=document.createElement("input");
$(b).datepicker();
return b
}};
metawidget.jqueryui.widgetprocessor=metawidget.jqueryui.widgetprocessor||{};
metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor=function(){if(!(this instanceof metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor)){throw new Error("Constructor called as a function")
}};
metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.onStartBuild=function(a){a._jQueryUIBindingProcessorBindings={}
};
metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.processWidget=function(f,b,h){var e;
var d=metawidget.util.splitPath(h.path);
var g=metawidget.util.traversePath(h.toInspect,d.names);
if(b._root!=="true"&&g){e=g[b.name]
}else{e=g
}var c=false;
if(f.hasAttribute("class")){var a=f.getAttribute("class");
if(a.indexOf("ui-slider")!==-1){$(f).slider("value",e);
c=true
}else{if(a.indexOf("ui-spinner")!==-1){$(f.childNodes[0]).spinner("value",e);
c=true
}}}if(c===true||f.metawidget!==undefined){h._jQueryUIBindingProcessorBindings[b.name]=f
}return f
};
metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor.prototype.save=function(f){var c=metawidget.util.splitPath(f.path);
var e=metawidget.util.traversePath(f.toInspect,c.names);
for(var b in f._jQueryUIBindingProcessorBindings){var d=f._jQueryUIBindingProcessorBindings[b];
if(d.metawidget!==undefined){this.save(d.metawidget);
continue
}d=document.getElementById(d.id);
var a=d.getAttribute("class");
if(a.indexOf("ui-slider")!==-1){e[b]=$(d).slider("value")
}else{if(a.indexOf("ui-spinner")!==-1){e[b]=$(d.childNodes[0]).spinner("value")
}}}};
metawidget.jqueryui.layout=metawidget.jqueryui.layout||{};
metawidget.jqueryui.layout.TabLayoutDecorator=function(a){if(!(this instanceof metawidget.jqueryui.layout.TabLayoutDecorator)){throw new Error("Constructor called as a function")
}metawidget.layout.createNestedSectionLayoutDecorator(a,this,"tabLayoutDecorator");
var b=this.onEndBuild;
this.onEndBuild=function(e){if(e.tabLayoutDecorator!==undefined){for(var c=0,d=e.tabLayoutDecorator.length;
c<d;
c++){$(e.tabLayoutDecorator[c]).tabs()
}}if(b!==undefined){b(e)
}}
};
metawidget.jqueryui.layout.TabLayoutDecorator.prototype.createSectionWidget=function(i,j,e,b,l){var g=i;
if(g===undefined){g=document.createElement("div");
g.setAttribute("id",metawidget.util.getId(e,l)+"-tabs");
g.appendChild(document.createElement("ul"));
this.getDelegate().layoutWidget(g,{wide:"true"},b,l);
l.tabLayoutDecorator=l.tabLayoutDecorator||[];
l.tabLayoutDecorator.push(g)
}else{g=i.parentNode
}var f=g.childNodes[0];
var c=g.getAttribute("id")+(f.childNodes.length+1);
var k=document.createElement("li");
var h=document.createElement("a");
h.setAttribute("href","#"+c);
h.hash="#"+c;
k.appendChild(h);
f.appendChild(k);
var d=document.createElement("div");
d.setAttribute("id",c);
g.appendChild(d);
h.innerHTML=j;
return d
};
$.widget("metawidget.metawidget",{options:{readOnly:false,inspector:new metawidget.inspector.PropertyTypeInspector(),widgetBuilder:new metawidget.widgetbuilder.CompositeWidgetBuilder([new metawidget.widgetbuilder.OverriddenWidgetBuilder(),new metawidget.jqueryui.widgetbuilder.JQueryUIWidgetBuilder(),new metawidget.widgetbuilder.ReadOnlyWidgetBuilder(),new metawidget.widgetbuilder.HtmlWidgetBuilder()]),widgetProcessors:[new metawidget.widgetprocessor.IdProcessor(),new metawidget.widgetprocessor.RequiredAttributeProcessor(),new metawidget.jqueryui.widgetprocessor.JQueryUIBindingProcessor(),new metawidget.widgetprocessor.SimpleBindingProcessor()],layout:new metawidget.layout.HeadingTagLayoutDecorator(new metawidget.layout.TableLayout())},_create:function(){this._pipeline=new metawidget.Pipeline(this.element[0]);
this._pipeline.buildNestedMetawidget=function(d,i){var h=document.createElement("div");
var f=$(h).metawidget(i.options);
f.metawidget("option","readOnly",i.readOnly||d.readOnly==="true");
var e=i.toInspect;
var g=metawidget.util.appendPath(d,i);
h.metawidget=$(h).data("metawidget");
f.metawidget("buildWidgets",e,g);
return h
};
this._pipeline.configure(this.options);
this._overriddenNodes=[];
var c=this.element[0];
for(var a=0;
a<c.childNodes.length;
){if(c.childNodes[a].nodeType!==1){a++;
continue
}var b=c.childNodes[a];
c.removeChild(b);
this._overriddenNodes.push(b)
}this._refresh()
},_refresh:function(d){this.overriddenNodes=[];
for(var a=0,c=this._overriddenNodes.length;
a<c;
a++){this.overriddenNodes.push(this._overriddenNodes[a].cloneNode(true))
}if(d===undefined){var b=metawidget.util.splitPath(this.path);
d=this._pipeline.inspect(this.toInspect,b.type,b.names,this)
}this._pipeline.buildWidgets(d,this)
},_setOptions:function(){this._superApply(arguments);
this._pipeline.configure(this.options);
this._refresh()
},_setOption:function(a,b){if(a==="readOnly"){this.readOnly=b
}this._super(a,b)
},buildWidgets:function(b,a){if(b!==undefined){this.toInspect=b;
this.path=undefined
}if(a!==undefined){this.path=a
}this._refresh()
},getWidgetProcessor:function(a){return this._pipeline.getWidgetProcessor(a)
}});
